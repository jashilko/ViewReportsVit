# Проект по выводу отчетов о звонках клиентов Asterisk IP АТС

Проект представляет из себя веб-приложение.
Серверная часть - **FastAPI** с полноценной системой аутентификации и авторизации.
Фронтэнт: html + js
БД используется от Asterisk MariaDB, взаимодействие с ней через **SQLAlchemy** с асинхронной поддержкой. В БД создана одна новая таблица для хранения пользователей приложения.
Все компоненты разворачиваются в Docker

## Функциональность в зависимости от роли пользователя
- Оператор
  - Отображение списка звонков за период
  - Просмотр статистики за период
  - Поиск по номеру телефона в отобранных записях
  - Прослушивание записи звонка
  - Ссылка на аудиозапись звонка   
- Руководитель группы (контролирует несколько операторов)
  - Функционал оператора, но для любого оператора, входящего в группу
  - Статистика звонков всей группы за период
- Контролер
  - Функционал оператора, но для любого оператора
  - Статистика всех операторов за перион
- Администратор
  - Регистрация пользователей
  - Назначение и смена ролей
  - Сброс паролей пользователей
  - Назначение операторам руководителей

## Стек технологий
- **Веб-фреймворк**: FastAPI
- **Фронтэнд**: HTML, JavaScript, Jinja2
- **ORM**: SQLAlchemy с асинхронной поддержкой через aiosqlite
- **Авторизация/Аутентификация**: bcrypt для хеширования паролей, python-jose для защиты данных с использованием JWT
- **Тесты**: PyTest
- **Deploy**: Docker, docker-compose

## Основные зависимости проекта

- `fastapi==0.115.6` - высокопроизводительный веб-фреймворк
- `pydantic==2.9.2` - валидация данных
- `uvicorn==0.32.1` - ASGI-сервер
- `Jinja2==3.1.4` - шаблонизатор
- `SQLAlchemy==2.0.36` - ORM для работы с базами данных
- `bcrypt==4.0.1` и `passlib==1.7.4` - хеширование паролей
- `python-jose==3.3.0` - работа с JWT токенами
- `pytest==8.3.4` и `pytest-asyncio==0.25.3` - юнит-тесты


## Настройка файла-конфигурации

В файле `.env` должны присутствовать следующие переменные: 
```
#Секретный ключ для шифрования паролей
SECRET_KEY=
# Алгоритм шифрования паролей
ALGORITHM=HS256
# Логин администратора, если ещё не создан
ADMIN_LOGIN=999
# Стартовый пароль администратора
START_PASS=pass
# Строка подключения к БД (asteriskcdrdb)
CONN_STR=mysql+asyncmy://user:pass@host:port/db-name-asteriskcdrdb
# Строка подключения к БД (asterisk)
CONN_STR_ASTERISK=mysql+asyncmy://user:pass@host:port/db-name-asterisk
# Путь, где храняться записи звонков
AUDIO_PATH=./audio
# Настройка, сколько дней назад фильтр будет отображаться по умолчанию дата От в фильтрах
FILTER_MINUS_DAYS_FROM=5
```

## Установка и запуск приложения
0. Предварительно установить Docker и docker-compose для вашей ОС
1. Клонировать репозиторий:
   ```bash
   git clone https://github.com/jashilko/ViewReportsVit.git
   ```
2. Создать в директории настроечный файл `.env`
3. Запустить docker-compose:
   ```bash
   docker-compose up
   ```
## Особенности первого запуска
- При первом запуске в БД asteriskcdrdb автоматически создастся таблица SiteUser, а в ней пользователь - Администратор сайта с логином ADMIN_LOGIN

